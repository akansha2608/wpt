<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//" "">
<title>link: error events in limited quirks mode</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src=/common/get-host-info.sub.js></script>
<div id="log"></div>
<script>
[
 ["same-origin", "resources/css.py"],
 ["cross-origin", get_host_info().HTTP_REMOTE_ORIGIN + "/html/semantics/document-metadata/the-link-element/resources/css.py"]
].forEach(originType => {
  ["no Content-Type", "wrong Content-Type", "broken Content-Type"].forEach(contentType => {
    ["no nosniff", "nosniff"].forEach(nosniff => {
      async_test(t => {
        const l = document.createElement("link");
        t.add_cleanup(() => l.remove());
        if (nosniff === "nosniff" || contentType === "wrong Content-Type") {
          l.onerror = t.step_func_done();
          l.onload = t.unreached_func("error event should have fired");
        } else {
          l.onload = t.step_func_done();
          l.onerror = t.unreached_func("load event should have fired");
        }
        l.rel = "stylesheet";
        let query = [];
        if (contentType === "broken Content-Type") {
          query.push("content_type=oops");
        } else if (contentType === "wrong Content-Type") {
          query.push("content_type=text/plain")
        }
        if (nosniff === "nosniff") {
          query.push("nosniff");
        }
        let stringQuery = "";
        query.forEach(val => {
          if (stringQuery === "") {
            stringQuery += "?" + val;
          } else {
            stringQuery += "&" + val;
          }
        });
        l.href = originType[1] + stringQuery;
        document.head.appendChild(l);
      }, "Stylesheet with " + contentType + ", " + originType[0] + ", and " + nosniff);
    });
  });
});
</script>
